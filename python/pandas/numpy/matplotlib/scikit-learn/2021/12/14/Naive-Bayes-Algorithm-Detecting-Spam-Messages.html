<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Naive Bayes Algorithm for Detecting Spam Messages | MG Data Science</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Naive Bayes Algorithm for Detecting Spam Messages" />
<meta name="author" content="Migs Germar" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I code a multinomial naive bayes algorithm, step-by-step, in order to identify messages as spam or non-spam. I then test the model and evaluate it using various metrics of model performance." />
<meta property="og:description" content="I code a multinomial naive bayes algorithm, step-by-step, in order to identify messages as spam or non-spam. I then test the model and evaluate it using various metrics of model performance." />
<link rel="canonical" href="https://miguelahg.github.io/mahg-data-science/python/pandas/numpy/matplotlib/scikit-learn/2021/12/14/Naive-Bayes-Algorithm-Detecting-Spam-Messages.html" />
<meta property="og:url" content="https://miguelahg.github.io/mahg-data-science/python/pandas/numpy/matplotlib/scikit-learn/2021/12/14/Naive-Bayes-Algorithm-Detecting-Spam-Messages.html" />
<meta property="og:site_name" content="MG Data Science" />
<meta property="og:image" content="https://miguelahg.github.io/mahg-data-science/images/spam-unsplash-hannes_johnson.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-14T00:00:00-06:00" />
<script type="application/ld+json">
{"url":"https://miguelahg.github.io/mahg-data-science/python/pandas/numpy/matplotlib/scikit-learn/2021/12/14/Naive-Bayes-Algorithm-Detecting-Spam-Messages.html","@type":"BlogPosting","headline":"Naive Bayes Algorithm for Detecting Spam Messages","dateModified":"2021-12-14T00:00:00-06:00","datePublished":"2021-12-14T00:00:00-06:00","image":"https://miguelahg.github.io/mahg-data-science/images/spam-unsplash-hannes_johnson.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://miguelahg.github.io/mahg-data-science/python/pandas/numpy/matplotlib/scikit-learn/2021/12/14/Naive-Bayes-Algorithm-Detecting-Spam-Messages.html"},"author":{"@type":"Person","name":"Migs Germar"},"description":"I code a multinomial naive bayes algorithm, step-by-step, in order to identify messages as spam or non-spam. I then test the model and evaluate it using various metrics of model performance.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/mahg-data-science/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://miguelahg.github.io/mahg-data-science/feed.xml" title="MG Data Science" /><link rel="shortcut icon" type="image/x-icon" href="/mahg-data-science/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/mahg-data-science/">MG Data Science</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/mahg-data-science/about/">About Me</a><a class="page-link" href="/mahg-data-science/search/">Search</a><a class="page-link" href="/mahg-data-science/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Naive Bayes Algorithm for Detecting Spam Messages</h1><p class="page-description">I code a multinomial naive bayes algorithm, step-by-step, in order to identify messages as spam or non-spam. I then test the model and evaluate it using various metrics of model performance.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-12-14T00:00:00-06:00" itemprop="datePublished">
        Dec 14, 2021
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Migs Germar</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      28 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/mahg-data-science/categories/#python">python</a>
        &nbsp;
      
        <a class="category-tags-link" href="/mahg-data-science/categories/#pandas">pandas</a>
        &nbsp;
      
        <a class="category-tags-link" href="/mahg-data-science/categories/#numpy">numpy</a>
        &nbsp;
      
        <a class="category-tags-link" href="/mahg-data-science/categories/#matplotlib">matplotlib</a>
        &nbsp;
      
        <a class="category-tags-link" href="/mahg-data-science/categories/#scikit-learn">scikit-learn</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/MiguelAHG/mahg-data-science/tree/master/_notebooks/2021-12-14-Naive-Bayes-Algorithm-Detecting-Spam-Messages.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/mahg-data-science/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          
          
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#Introduction">Introduction </a></li>
<li class="toc-entry toc-h1"><a href="#Packages">Packages </a></li>
<li class="toc-entry toc-h1"><a href="#The-Dataset">The Dataset </a></li>
<li class="toc-entry toc-h1"><a href="#Training-and-Testing-Sets">Training and Testing Sets </a></li>
<li class="toc-entry toc-h1"><a href="#The-Algorithm">The Algorithm </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Main-Formulas">Main Formulas </a></li>
<li class="toc-entry toc-h2"><a href="#Additive-Smoothing-and-Vocabulary">Additive Smoothing and Vocabulary </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Implementation">Implementation </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Model-Parameters">Model Parameters </a>
<ul>
<li class="toc-entry toc-h3"><a href="#$P_{Spam},-P_{Ham}$">$P_{Spam}, P_{Ham}$ </a></li>
<li class="toc-entry toc-h3"><a href="#Message-Preprocessing">Message Preprocessing </a></li>
<li class="toc-entry toc-h3"><a href="#Vocabulary">Vocabulary </a></li>
<li class="toc-entry toc-h3"><a href="#$N_{Spam},-N_{Ham}$">$N_{Spam}, N_{Ham}$ </a></li>
<li class="toc-entry toc-h3"><a href="#$N_{w_i|Spam},-N_{w_i|Ham}$">$N_{w_i|Spam}, N_{w_i|Ham}$ </a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#Predictive-Function">Predictive Function </a></li>
<li class="toc-entry toc-h2"><a href="#Model-Evaluation">Model Evaluation </a>
<ul>
<li class="toc-entry toc-h3"><a href="#Accuracy">Accuracy </a></li>
<li class="toc-entry toc-h3"><a href="#Confusion-Matrix">Confusion Matrix </a></li>
<li class="toc-entry toc-h3"><a href="#Recall,-Precision,-F1">Recall, Precision, F1 </a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#scikit-learn-Classes-for-Naive-Bayes">scikit-learn Classes for Naive Bayes </a></li>
<li class="toc-entry toc-h1"><a href="#Conclusion">Conclusion </a></li>
<li class="toc-entry toc-h1"><a href="#Bibliography">Bibliography </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Data-Source">Data Source </a></li>
<li class="toc-entry toc-h2"><a href="#Information-Sources">Information Sources </a></li>
<li class="toc-entry toc-h2"><a href="#Image-Source">Image Source </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Appendix">Appendix </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2021-12-14-Naive-Bayes-Algorithm-Detecting-Spam-Messages.ipynb
-->

<div class="container" id="notebook-container">
        
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<center><img src="https://miguelahg.github.io/mahg-data-science/images/spam-unsplash-hannes_johnson.jpg" alt=""></center>
<center><a href="https://unsplash.com/photos/mRgffV3Hc6c">Unsplash | Hannes Johnson</a></center>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Introduction">
<a class="anchor" href="#Introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction<a class="anchor-link" href="#Introduction"> </a>
</h1>
<p>The Multinomial Naive Bayes Algorithm is a machine learning algorithm based on the Bayes Theorem. It calculates the probability that an event $B$ occurred given that event $A$ occurred. Thus, it is usually used in classification problems. (Vadapalli, 2021)</p>
<p>In this project, we will use the algorithm to determine the probability that a message is spam given its contents. We will then use this probability to decide whether to treat new messages as spam or not. For example, if the probability of being spam is over 50%, then we may treat the message as spam.</p>
<p>Identifying spam is important in the Philippines because phishing campaigns went up by 200% after the pandemic began (Devanesan, 2020), and a telecommunications provider recently had to block around 71 million spam messages (Yap, 2021). Such messages may attempt to steal personal information, steal money from an account, or install malware (FTC, 2020). Thus, machine learning can be a very helpful tool in preventing such harm from occurring.</p>
<p>Though the algorithm can be easily implemented using existing functions such as those in the <a href="https://scikit-learn.org/stable/modules/naive_bayes.html#multinomial-naive-bayes">scikit-learn package</a>, I will manually code the algorithm step-by-step in order to explain the mathematical intuition behind it.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p></p>
<div class="flash">
    <svg class="octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
    <strong>Note: </strong>I wrote this notebook by following a guided project on the <a href="https://www.dataquest.io/">Dataquest</a> platform, specifically the <a href="https://app.dataquest.io/c/74/m/433/guided-project%3A-building-a-spam-filter-with-naive-bayes/1/exploring-the-dataset">Guided Project: Building a Spam Filter with Naive Bayes</a> The general project flow came from Dataquest. The mathematical explanations are also based on what I learned from Dataquest.
</div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Packages">
<a class="anchor" href="#Packages" aria-hidden="true"><span class="octicon octicon-link"></span></a>Packages<a class="anchor-link" href="#Packages"> </a>
</h1>
<p>Below are the packages necessary for this project.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">ConfusionMatrixDisplay</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Dataset">
<a class="anchor" href="#The-Dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Dataset<a class="anchor-link" href="#The-Dataset"> </a>
</h1>
<p>We will use the SMS Spam Collection Dataset by Almeida and Hidalgo in 2012. It can be downloaded from the <a href="https://archive.ics.uci.edu/ml/datasets/sms+spam+collection">UCI Machine Learning Repository</a>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sms_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">"./private/Naive-Bayes-Files/SMSSpamCollection"</span><span class="p">,</span>
    <span class="c1"># Tab-separated</span>
    <span class="n">sep</span> <span class="o">=</span> <span class="s2">"</span><span class="se">\t</span><span class="s2">"</span><span class="p">,</span>
    <span class="n">header</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"label"</span><span class="p">,</span> <span class="s2">"sms"</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">sms_df</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class 'pandas.core.frame.DataFrame'&gt;
RangeIndex: 5572 entries, 0 to 5571
Data columns (total 2 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   label   5572 non-null   object
 1   sms     5572 non-null   object
dtypes: object(2)
memory usage: 87.2+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The dataset has 2 columns and 5572 rows.</p>
<ul>
<li>The <code>label</code> column contains "ham" if the message is legitimate, or "spam" if it is spam.</li>
<li>The <code>sms</code> column contains individual SMS messages.</li>
</ul>
<p>For example, below are the first 5 rows of the dataset.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sms_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>label</th>
      <th>sms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>ham</td>
      <td>Go until jurong point, crazy.. Available only ...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>ham</td>
      <td>Ok lar... Joking wif u oni...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>spam</td>
      <td>Free entry in 2 a wkly comp to win FA Cup fina...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ham</td>
      <td>U dun say so early hor... U c already then say...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ham</td>
      <td>Nah I don't think he goes to usf, he lives aro...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Training-and-Testing-Sets">
<a class="anchor" href="#Training-and-Testing-Sets" aria-hidden="true"><span class="octicon octicon-link"></span></a>Training and Testing Sets<a class="anchor-link" href="#Training-and-Testing-Sets"> </a>
</h1>
<p>The messages will be split into two sets. The training set, comprising 80% of the total data, will be used to train the Naive Bayes Algorithm. The testing set, with 20% of the total data, will be used to test the model's accuracy.</p>
<p>First, however, let us calculate what percentage of the messages in the dataset are spam.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">spam_perc</span> <span class="o">=</span> <span class="n">sms_df</span><span class="p">[</span><span class="s2">"label"</span><span class="p">]</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s2">"spam"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">sms_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Percentage of spam messages: </span><span class="si">{</span><span class="n">spam_perc</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Percentage of spam messages: 13.41%
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Only 13% of the messages are spam. Therefore, spam and non-spam messages are not equally represented in this dataset, and this may be problematic. However, this is all the data we have, so the best we can do is to ensure that both the training and testing sets have around 13% of their messages as spam.</p>
<p>This is an example of <em>proportionate stratified sampling</em> (Thomas, 2020). We first separate the data into two strata (spam and non-spam). We then take 80% of the messages from each strata as the training set. The remaining 20% of each strata is set aside for the testing set. Thus, each of the two sets will contain around 13% spam.</p>
<p>This has been done with the code below.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Note: I could have used `train_test_split` from sklearn, but I coded this manually for the sake of grasping the logic.</span>
<span class="n">split_lists</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"training"</span><span class="p">:</span> <span class="p">[],</span>
    <span class="s2">"testing"</span><span class="p">:</span> <span class="p">[],</span>
<span class="p">}</span>

<span class="c1"># Stratify the dataset</span>
<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="s2">"spam"</span><span class="p">,</span> <span class="s2">"ham"</span><span class="p">:</span>
    <span class="n">stratum</span> <span class="o">=</span> <span class="n">sms_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">sms_df</span><span class="p">[</span><span class="s2">"label"</span><span class="p">]</span> <span class="o">==</span> <span class="n">label</span><span class="p">]</span>

    <span class="n">train_part</span> <span class="o">=</span> <span class="n">stratum</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span>
        <span class="c1"># Sample 80% of the data points</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
        <span class="n">random_state</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># The other 20% that were not sampled go to the testing set.</span>
    <span class="n">test_part</span> <span class="o">=</span> <span class="n">stratum</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">stratum</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">train_part</span><span class="o">.</span><span class="n">index</span><span class="p">)]</span>

    <span class="n">split_lists</span><span class="p">[</span><span class="s2">"training"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">train_part</span><span class="p">)</span>
    <span class="n">split_lists</span><span class="p">[</span><span class="s2">"testing"</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">test_part</span><span class="p">)</span>

<span class="n">split_dfs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="s2">"object"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">split_lists</span><span class="p">:</span>
    <span class="c1"># Concatenate spam and non-spam parts into one DataFrame.</span>
    <span class="n">set_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">split_lists</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
    <span class="n">split_dfs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">set_df</span>

    <span class="n">perc_spam</span> <span class="o">=</span> <span class="n">set_df</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s1">'spam'</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">set_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of rows in </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> set: </span><span class="si">{</span><span class="n">set_df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Percentage of </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2"> messages that are spam: </span><span class="si">{</span><span class="n">perc_spam</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of rows in training set: 4458
Percentage of training messages that are spam: 13.41%
Number of rows in testing set: 1114
Percentage of testing messages that are spam: 13.38%
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can see that the percentage of spam messages is roughly the same between the two sets. This will help the accuracy of the model later on.</p>
<p>Now, the two sets will be further split into <code>X</code> and <code>y</code>. <code>y</code> refers to the <strong>target</strong>, or the variable that we are trying to predict. In this case, we are trying to predict whether a message is spam or non-spam, so the "label" column is the target:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sms_df</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0     ham
1     ham
2    spam
3     ham
4     ham
Name: label, dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>On the other hand, <code>X</code> refers to the <strong>features</strong>, which are information used to predict the target. We only have one feature column as of now, which is the "sms" column.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">sms_df</span><span class="o">.</span><span class="n">sms</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0    Go until jurong point, crazy.. Available only ...
1                        Ok lar... Joking wif u oni...
2    Free entry in 2 a wkly comp to win FA Cup fina...
3    U dun say so early hor... U c already then say...
4    Nah I don't think he goes to usf, he lives aro...
Name: sms, dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Thus, we end up with four final objects:</p>
<ul>
<li>
<code>X_train</code>: The messages in the training data.</li>
<li>
<code>X_test</code>: The messages in the testing data.</li>
<li>
<code>y_train</code>: The labels in the training data. These correspond to <code>X_train</code>.</li>
<li>
<code>y_test</code>: The labels in the testing data. These correspond to <code>X_test</code>.</li>
</ul>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The four objects listed above.</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">split_dfs</span><span class="o">.</span><span class="n">training</span><span class="p">[[</span><span class="s2">"sms"</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">split_dfs</span><span class="o">.</span><span class="n">testing</span><span class="p">[[</span><span class="s2">"sms"</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y_train</span> <span class="o">=</span> <span class="n">split_dfs</span><span class="o">.</span><span class="n">training</span><span class="p">[</span><span class="s2">"label"</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">y_test</span> <span class="o">=</span> <span class="n">split_dfs</span><span class="o">.</span><span class="n">testing</span><span class="p">[</span><span class="s2">"label"</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="The-Algorithm">
<a class="anchor" href="#The-Algorithm" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Algorithm<a class="anchor-link" href="#The-Algorithm"> </a>
</h1>
<p>Now, let's discuss the multinomial naive bayes algorithm. Conditional probability is necessary in order to understand it. For our use case, let $Spam$ be the event that a message is spam, and $Ham$ be the event for non-spam.
</p>
<div class="flash">
    <svg class="octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
    <strong>Note: </strong>The mathematical explanations below are not my own ideas. I learned these from the Dataquest course on Naive Bayes.
</div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Main-Formulas">
<a class="anchor" href="#Main-Formulas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Main Formulas<a class="anchor-link" href="#Main-Formulas"> </a>
</h2>
<p>We want to compare the probability that a given message is spam to the probability that it is ham. Thus, we use the following formulas:</p>
<p>$P(Spam|w_1, w_2, \dots , w_n) \propto P(Spam) \cdot \Pi_{i=1}^n P(w_i|Spam)$</p>
<p>$P(Ham|w_1, w_2, \dots , w_n) \propto P(Ham) \cdot \Pi_{i=1}^n P(w_i|Ham)$
</p>
<div class="flash">
    <svg class="octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
    <strong>Note: </strong>These formulas are not the same as the Bayes Theorem. To understand how these were derived from the Bayes Theorem, see the Appendix of this post.
</div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>These two formulas are identical except for the $Spam$ or $Ham$ event. Let us just look at the first equation to unpack it.</p>
<p>The probability of event $B$ given that event $A$ has happened can be represented as $P(B|A)$ ("probability of B given A"). Thus, the left side of the formula, $P(Spam|w_1, w_2, \dots , w_n)$, represents the probability of spam given the contents of a message. Each variable $w_i$ represents one word in the message. For example, $w_1$ is the first word in the message, and so on.</p>
<p>In the middle, the "directly proportional to" sign ($\propto$) is used instead of the equals sign. The left and right sides are not equal, but one increases as the other increases.</p>
<p>At the right side, $P(Spam)$ simply refers to the probability that any message is spam. It can be calculated as the number of spam messages in the dataset over the total number of messages.</p>
<p>Finally, the formula ends with $\Pi_{i=1}^n P(w_i|Spam)$. The $P(w_i|Spam)$ part refers to the probability of a certain word occurring given that the message is known to be spam. We must calculate this probability for each word in the message. Then, because the uppercase pi ($\Pi$) refers to a product, we must multiply the word probabilities together.</p>
<h2 id="Additive-Smoothing-and-Vocabulary">
<a class="anchor" href="#Additive-Smoothing-and-Vocabulary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Additive Smoothing and Vocabulary<a class="anchor-link" href="#Additive-Smoothing-and-Vocabulary"> </a>
</h2>
<p>In order to calculate $P(w_i|Spam)$, we need to use the following formula:</p>
<p>$P(w_i | Spam) = \frac{N_{w_i | Spam} + \alpha}{N_{Spam} + \alpha \cdot N_{Vocabulary}}$</p>
<p>We use an almost identical equation for $P(w_i|Ham)$ as well:</p>
<p>$P(w_i | Ham) = \frac{N_{w_i | Ham} + \alpha}{N_{Ham} + \alpha \cdot N_{Vocabulary}}$</p>
<p>Again, let us just unpack the first formula. $N_{w_i|Spam}$ refers to the number of times that the word appears in the dataset's spam messages.</p>
<p>$\alpha$ is the <strong>additive smoothing parameter</strong>. We will use $\alpha = 1$. This is added to the numerator to prevent it from becoming zero. If it does become zero, the entire product in the main formula will become zero.</p>
<p>$N_{Spam}$ refers to the total number of words in all of the spam messages. Duplicate words are not removed when this is calculated.</p>
<p>Lastly, $N_{Vocabulary}$ refers to the number of words in the <strong>vocabulary</strong>. This is the set of all <em>unique</em> words found in any of the messages, whether spam or non-spam. Duplicates are removed.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Implementation">
<a class="anchor" href="#Implementation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Implementation<a class="anchor-link" href="#Implementation"> </a>
</h1>
<p>Based on the theory behind the algorithm, I have written a set of steps to implement it. I will use these steps as the pseudocode for this project.</p>
<ol>
<li>Determine the model <strong>parameters</strong>. These are the variables in the formulas shown earlier. Only the training data will be used for this.<ul>
<li>Find $P(Spam), P(Ham)$.<ul>
<li>Divide the number of spam messages by the total number of messages.</li>
<li>Do the same for ham messages.</li>
</ul>
</li>
<li>Preprocess the messages to focus on individual words.<ul>
<li>Make all words lowercase.</li>
<li>Remove punctuation marks.</li>
</ul>
</li>
<li>Form a vocabulary. <ul>
<li>Make a set of all the words in the messages, without duplicates.</li>
<li>$N_{Vocabulary}$ is the number of words in this set.</li>
</ul>
</li>
<li>Find $N_{Spam}, N_{Ham}$.<ul>
<li>Count the number of times each word appears in each message.</li>
<li>Count the total number of words in spam messages. Do the same for ham messages.</li>
</ul>
</li>
<li>Find $N_{w_i|Spam}, N_{w_i|Ham}$ for each word in the vocabulary.<ul>
<li>Sum up the word counts in spam messages to get $N_{w_i|Spam}$.</li>
<li>Do the same for ham messages to get $N_{w_i|Spam}$.</li>
</ul>
</li>
</ul>
</li>
<li>Write a <strong>predictive function</strong>. This takes a new message and predicts whether it is spam or not.<ul>
<li>Plug the values that we calculated previously into the equation.</li>
<li>Return $P(Spam|w_1, w_2, \dots , w_n)$, $P(Ham|w_1, w_2, \dots , w_n)$, and the prediction ("spam" or "ham").</li>
</ul>
</li>
<li>
<strong>Evaluate</strong> the model using the testing data.<ul>
<li>Make predictions for all messages in the testing set.</li>
<li>Divide the number of correct predictions by the total number of predictions. This will result in the accuracy of the model.</li>
</ul>
</li>
</ol>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-Parameters">
<a class="anchor" href="#Model-Parameters" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model Parameters<a class="anchor-link" href="#Model-Parameters"> </a>
</h2>
<p>In the first step, we will calculate the parameters of the model, which include the following.</p>
<ul>
<li>$P(Spam), P(Ham)$</li>
<li>$N_{Vocabulary}$</li>
<li>$N_{Spam}, N_{Ham}$</li>
<li>$N_{w_i|Spam}, N_{w_i|Ham}$</li>
</ul>
<p>We will calculate these values first so that we can plug them into the equation later on when we predict whether new messages are spam or non-spam.</p>
<h3 id="$P_{Spam},-P_{Ham}$">
<a class="anchor" href="#%24P_%7BSpam%7D,-P_%7BHam%7D%24" aria-hidden="true"><span class="octicon octicon-link"></span></a>$P_{Spam}, P_{Ham}$<a class="anchor-link" href="#%24P_%7BSpam%7D,-P_%7BHam%7D%24"> </a>
</h3>
<p>The probability of spam is equal to the number of spam messages over the total number of messages. The same goes for ham messages.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">p_label</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">p_label</span><span class="p">[</span><span class="s2">"spam"</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_train</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="s2">"spam"</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">y_train</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p_label</span><span class="p">[</span><span class="s2">"ham"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">p_label</span><span class="p">[</span><span class="s2">"spam"</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"P(Spam) = </span><span class="si">{</span><span class="n">p_label</span><span class="p">[</span><span class="s1">'spam'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"P(Ham) = </span><span class="si">{</span><span class="n">p_label</span><span class="p">[</span><span class="s1">'ham'</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>P(Spam) = 13.41%
P(Ham) = 86.59%
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Message-Preprocessing">
<a class="anchor" href="#Message-Preprocessing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Message Preprocessing<a class="anchor-link" href="#Message-Preprocessing"> </a>
</h3>
<p>Below are the messages:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Marvel Mobile Play the official Ultimate Spide...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Thank you, winner notified by sms. Good Luck! ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Free msg. Sorry, a service you ordered from 81...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Thanks for your ringtone order, ref number R83...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>PRIVATE! Your 2003 Account Statement for shows...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In order to get individual words, we make all words lowercase and remove punctuation marks and other non-word characters. We then turn each message into a list of its words.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">preprocess_messages</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">series</span>
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="c1"># Delete all non-word characters.</span>
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">r</span><span class="s2">"[^a-z0-9 ]"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
        <span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="n">X_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">preprocess_messages</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">sms</span><span class="p">))</span>

<span class="n">X_train</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>sms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[marvel, mobile, play, the, official, ultimate...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[thank, you, winner, notified, by, sms, good, ...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[free, msg, sorry, a, service, you, ordered, f...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[thanks, for, your, ringtone, order, ref, numb...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[private, your, 2003, account, statement, for,...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Vocabulary">
<a class="anchor" href="#Vocabulary" aria-hidden="true"><span class="octicon octicon-link"></span></a>Vocabulary<a class="anchor-link" href="#Vocabulary"> </a>
</h3>
<p>Using the preprocessed messages, we can form a set of all of the unique words that they contain.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">vocab</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
<span class="k">for</span> <span class="n">lst</span> <span class="ow">in</span> <span class="n">X_train</span><span class="o">.</span><span class="n">sms</span><span class="p">:</span>
    <span class="n">vocab</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">lst</span><span class="p">)</span>

<span class="c1"># Use a Series to delete items that are blank or only contain whitespace.</span>
<span class="n">vocab_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">vocab</span><span class="p">))</span>
<span class="n">vocab_series</span> <span class="o">=</span> <span class="n">vocab_series</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="o">~</span><span class="n">vocab_series</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">"^\s*$"</span><span class="p">)]</span>
<span class="n">vocab</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">vocab_series</span><span class="p">)</span>

<span class="n">n_vocab</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vocab</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of words in the vocabulary: </span><span class="si">{</span><span class="n">n_vocab</span><span class="si">}</span><span class="se">\n</span><span class="s2">First few items:"</span><span class="p">)</span>
<span class="nb">list</span><span class="p">(</span><span class="n">vocab</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of words in the vocabulary: 8385
First few items:
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>['silent',
 'receivea',
 'dismay',
 'noise',
 'platt',
 'li',
 'woohoo',
 'ucall',
 'wondarfull',
 '80082']</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Above are the first 10 items in the vocabulary. In total, $N_{Vocabulary} = 8385$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="$N_{Spam},-N_{Ham}$">
<a class="anchor" href="#%24N_%7BSpam%7D,-N_%7BHam%7D%24" aria-hidden="true"><span class="octicon octicon-link"></span></a>$N_{Spam}, N_{Ham}$<a class="anchor-link" href="#%24N_%7BSpam%7D,-N_%7BHam%7D%24"> </a>
</h3>
<p>Using the vocabulary, we can transform the messages to show the number of times that each word appears in each message.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">to_word_counts</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span><span class="p">):</span>
    <span class="n">vocab_lst</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">vocab</span><span class="p">))</span>

    <span class="n">word_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
        <span class="n">w</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">series</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">vocab_lst</span>
    <span class="p">})</span>

    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">word_lst</span> <span class="ow">in</span> <span class="n">series</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">word_lst</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">:</span>
                <span class="n">word_counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">return</span> <span class="n">word_counts</span>

<span class="n">word_counts</span> <span class="o">=</span> <span class="n">to_word_counts</span><span class="p">(</span><span class="n">X_train</span><span class="o">.</span><span class="n">sms</span><span class="p">)</span>

<span class="n">word_counts</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>008704050406</th>
      <th>0089my</th>
      <th>0121</th>
      <th>01223585236</th>
      <th>01223585334</th>
      <th>0125698789</th>
      <th>020603</th>
      <th>0207</th>
      <th>02070836089</th>
      <th>...</th>
      <th>zebra</th>
      <th>zed</th>
      <th>zeros</th>
      <th>zhong</th>
      <th>zindgi</th>
      <th>zoe</th>
      <th>zogtorius</th>
      <th>zoom</th>
      <th>zouk</th>
      <th>zyada</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 8385 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the table above, each row represents a message. Each column represents a unique word in the vocabulary. The cells show the number of times that each word appeared in each message.</p>
<p>Now, we can calculate $N_{Spam}, N_{Ham}$:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">count_n</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">word_counts</span> <span class="o">=</span> <span class="n">word_counts</span><span class="p">):</span>
    <span class="n">n_label</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">word_counts</span>
        <span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">y_train</span> <span class="o">==</span> <span class="n">label</span><span class="p">,</span> <span class="p">:]</span>
        <span class="c1"># Sum all of the numbers in the df.</span>
        <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">n_label</span>

<span class="n">n_label</span> <span class="o">=</span> <span class="p">{}</span>

<span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"spam"</span><span class="p">,</span> <span class="s2">"ham"</span><span class="p">]:</span>
    <span class="n">n_label</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_n</span><span class="p">(</span><span class="n">label</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of words in spam messages: </span><span class="si">{</span><span class="n">n_label</span><span class="p">[</span><span class="s1">'spam'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of words in ham messages: </span><span class="si">{</span><span class="n">n_label</span><span class="p">[</span><span class="s1">'ham'</span><span class="p">]</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of words in spam messages: 14037
Number of words in ham messages: 53977
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The result is that $N_{Spam} = 14037$ and $N_{Ham} = 53977$.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="$N_{w_i|Spam},-N_{w_i|Ham}$">
<a class="anchor" href="#%24N_%7Bw_i%7CSpam%7D,-N_%7Bw_i%7CHam%7D%24" aria-hidden="true"><span class="octicon octicon-link"></span></a>$N_{w_i|Spam}, N_{w_i|Ham}$<a class="anchor-link" href="#%24N_%7Bw_i%7CSpam%7D,-N_%7Bw_i%7CHam%7D%24"> </a>
</h3>
<p>Finally, we can use the word counts to determine these two parameters. Recall that $N_{w_i|Spam}$ is the number of times that a certain word $w_i$ appeared in the spam messages.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">full_train</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">y_train</span><span class="p">,</span> <span class="n">word_counts</span><span class="p">],</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">n_word_given_label</span> <span class="o">=</span> <span class="n">full_train</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">vocab_lst</span><span class="p">,</span>
    <span class="n">index</span> <span class="o">=</span> <span class="s2">"label"</span><span class="p">,</span>
    <span class="n">aggfunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">n_word_given_label</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>008704050406</th>
      <th>0089my</th>
      <th>0121</th>
      <th>01223585236</th>
      <th>01223585334</th>
      <th>0125698789</th>
      <th>020603</th>
      <th>0207</th>
      <th>02070836089</th>
      <th>...</th>
      <th>zebra</th>
      <th>zed</th>
      <th>zeros</th>
      <th>zhong</th>
      <th>zindgi</th>
      <th>zoe</th>
      <th>zogtorius</th>
      <th>zoom</th>
      <th>zouk</th>
      <th>zyada</th>
    </tr>
    <tr>
      <th>label</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>ham</th>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>spam</th>
      <td>3</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>4</td>
      <td>2</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>4</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>2 rows × 8385 columns</p>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The table above can be used to access these parameters. For example, if we want to access $N_{w_i | Spam}$ for the word "hello", we can look at the value where the "spam" row and "hello" column intersect. The value is the number of times that "hello" appeared in the spam messages.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">n_hello_spam</span> <span class="o">=</span> <span class="n">n_word_given_label</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="s2">"spam"</span><span class="p">,</span> <span class="s2">"hello"</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Number of times that 'hello' appeared in spam messages: </span><span class="si">{</span><span class="n">n_hello_spam</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Number of times that 'hello' appeared in spam messages: 3
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Predictive-Function">
<a class="anchor" href="#Predictive-Function" aria-hidden="true"><span class="octicon octicon-link"></span></a>Predictive Function<a class="anchor-link" href="#Predictive-Function"> </a>
</h2>
<p>Now that all of the parameters have been found, we can write a function that will take a new message and classify it as spam or non-spam. This function will use the formulas explained earlier.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">word_lst</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="s2">"both"</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">vocab</span> <span class="o">=</span> <span class="n">vocab</span><span class="p">,</span> <span class="n">p_label</span> <span class="o">=</span> <span class="n">p_label</span><span class="p">,</span> <span class="n">n_label</span> <span class="o">=</span> <span class="n">n_label</span><span class="p">,</span> <span class="n">n_word_given_label</span> <span class="o">=</span> <span class="n">n_word_given_label</span><span class="p">):</span>
    <span class="sd">"""Given the list of words in a message, predict whether it is spam or ham.</span>
<span class="sd">word_lst: The preprocessed list of words in the message.</span>
<span class="sd">out: "both" to output both probabilities and prediction in a tuple. "pred" to output only the prediction as a string."""</span>

    <span class="c1"># Set up a Series to store results</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">"spam"</span><span class="p">,</span> <span class="s2">"ham"</span><span class="p">]:</span>
        <span class="c1"># Use P(Spam) or P(Ham)</span>
        <span class="n">final</span> <span class="o">=</span> <span class="n">p_label</span><span class="p">[</span><span class="n">label</span><span class="p">]</span>

        <span class="c1"># Iterate through words in the message.</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">word_lst</span><span class="p">:</span>
            <span class="c1"># Only include a word if it is already in the vocabulary.</span>
            <span class="k">if</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">vocab</span><span class="p">:</span>
                <span class="c1"># Calculate P(w1, w2, ..., wn | Spam) using the formula.</span>
                <span class="n">p_word_given_label</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="p">(</span><span class="n">n_word_given_label</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">label</span><span class="p">,</span> <span class="n">w</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span><span class="p">)</span>
                    <span class="o">/</span> <span class="p">(</span><span class="n">n_label</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">+</span> <span class="n">alpha</span> <span class="o">*</span> <span class="n">n_vocab</span><span class="p">)</span>
                <span class="p">)</span>

                <span class="c1"># Multiply the result into the final value.</span>
                <span class="n">final</span> <span class="o">*=</span> <span class="n">p_word_given_label</span>

        <span class="n">results</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">final</span>
    
    <span class="c1"># The prediction is the label with the higher probability in the Series.</span>
    <span class="c1"># If the probabilities are equal, the prediction is "uncertain"</span>
    <span class="k">if</span> <span class="n">results</span><span class="p">[</span><span class="s2">"spam"</span><span class="p">]</span> <span class="o">==</span> <span class="n">results</span><span class="p">[</span><span class="s2">"ham"</span><span class="p">]:</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="s2">"uncertain"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">out</span> <span class="o">==</span> <span class="s2">"both"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">results</span><span class="p">,</span> <span class="n">prediction</span>
    <span class="k">elif</span> <span class="n">out</span> <span class="o">==</span> <span class="s2">"pred"</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">prediction</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let us try using this function to predict whether a message is spam or ham. We will use this example: "you won a prize claim it now by sending credit card details".</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">results</span><span class="p">,</span> <span class="n">prediction</span> <span class="o">=</span> <span class="n">predict</span><span class="p">(</span><span class="s2">"you won a prize claim it now by sending credit card details"</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">"Results:"</span><span class="p">)</span>
<span class="k">for</span> <span class="n">label</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"P(</span><span class="si">{</span><span class="n">label</span><span class="si">}</span><span class="s2"> | message) is proportional to </span><span class="si">{</span><span class="n">value</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"This message is predicted to be </span><span class="si">{</span><span class="n">prediction</span><span class="si">}</span><span class="s2">."</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Results:
P(spam | message) is proportional to 2.3208952599406518e-35
P(ham | message) is proportional to 1.8781562825001382e-41
This message is predicted to be spam.
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The algorithm determined that $P(Spam|w_1, w_2, \dots , w_n) \propto 2.32 \cdot 10^{-35}$, whereas $P(Ham|w_1, w_2, \dots , w_n) \propto 1.88 \cdot 10^{-41}$. Since the probability for spam was higher, it predicted that the message was spam.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Model-Evaluation">
<a class="anchor" href="#Model-Evaluation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Model Evaluation<a class="anchor-link" href="#Model-Evaluation"> </a>
</h2>
<p>The final step is to evaluate the predictive function. We will use the function to predict labels for the messages in the testing set. Then, we will show the predicted labels side-by-side with the real labels.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Preprocess testing messages</span>
<span class="n">X_test_preprocessed</span> <span class="o">=</span> <span class="n">preprocess_messages</span><span class="p">(</span><span class="n">X_test</span><span class="o">.</span><span class="n">sms</span><span class="p">)</span>

<span class="c1"># Make predictions</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">X_test_preprocessed</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">predict</span><span class="p">,</span> <span class="n">out</span> <span class="o">=</span> <span class="s2">"pred"</span><span class="p">)</span>
<span class="n">y_pred</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">"prediction"</span>

<span class="c1"># Concatenate</span>
<span class="n">full_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
    <span class="p">[</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">X_test</span><span class="p">],</span>
    <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span>
<span class="p">)</span>

<span class="n">full_test</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>label</th>
      <th>prediction</th>
      <th>sms</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>spam</td>
      <td>spam</td>
      <td>England v Macedonia - dont miss the goals/team...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>spam</td>
      <td>spam</td>
      <td>SMS. ac Sptv: The New Jersey Devils and the De...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>spam</td>
      <td>spam</td>
      <td>Please call our customer service representativ...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>spam</td>
      <td>spam</td>
      <td>URGENT! Your Mobile No. was awarded £2000 Bonu...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>spam</td>
      <td>spam</td>
      <td>Sunshine Quiz Wkly Q! Win a top Sony DVD playe...</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The table above shows the first 5 rows of the testing set. We can see that the algorithm correctly predicted that the first 5 rows were spam.</p>
<h3 id="Accuracy">
<a class="anchor" href="#Accuracy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accuracy<a class="anchor-link" href="#Accuracy"> </a>
</h3>
<p>We will now calculate the overall accuracy of the model by dividing the number of correct predictions by the total number of predictions.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">acc</span> <span class="o">=</span> <span class="n">y_test</span><span class="o">.</span><span class="n">eq</span><span class="p">(</span><span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">y_pred</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Accuracy: 98.74%
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The model turned out to have a very high accuracy of 98.74%. This shows that it is effective at filtering spam from non-spam.</p>
<p>However, considering that spam and non-spam did not have equal representation in the data, with only 13% of all messages being spam, the accuracy may be misleading (Vallantin, 2018). For example, if a model is instructed to always predict that a message is ham, it would still have an accuracy of around 87%. Thus, to get a better picture of the performance of the model, we will make a confusion matrix and use other evaluation metrics such as precision, recall, and F1.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Confusion-Matrix">
<a class="anchor" href="#Confusion-Matrix" aria-hidden="true"><span class="octicon octicon-link"></span></a>Confusion Matrix<a class="anchor-link" href="#Confusion-Matrix"> </a>
</h3>
<p>A confusion matrix is a table that gives insight into how well a model was able to predict labels for datapoints (Brownlee, 2016).</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ham"</span><span class="p">,</span> <span class="s2">"spam"</span><span class="p">])</span>

<span class="n">disp</span> <span class="o">=</span> <span class="n">ConfusionMatrixDisplay</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">display_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"ham"</span><span class="p">,</span> <span class="s2">"spam"</span><span class="p">])</span>
<span class="n">disp</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">"Confusion Matrix of Results"</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this case, we only have two labels (spam and ham), so there are two rows and two columns. The vertical axis refers to the true labels, whereas the horizontal axis refers to the predicted labels.</p>
<p>For example, if we want to know how many true spam messages were incorrectly predicted to be ham, we can look at the "spam" row and "ham" column. The value is 13, which means that 13 messages were incorrectly predicted in this way.</p>
<p>If we consider ham messages as "negative" and spam messages as "positive," then the confusion matrix above shows the True Negatives (TN) in the top left, False Negatives (FN) in the top right, False Positives (FP) in the bottom left, and True Positives (TP) in the bottom right.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Recall,-Precision,-F1">
<a class="anchor" href="#Recall,-Precision,-F1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Recall, Precision, F1<a class="anchor-link" href="#Recall,-Precision,-F1"> </a>
</h3>
<p>Recall, Precision, and F1 are other metrics of model performance which may be useful when the labels are not represented equally in the data. Their equations are shown below; these were taken from Brownlee (2020).</p>
<p>Recall is the number of true positives divided by the total number of actual positives. It measures the "ability of the classifier to find all the positive samples. (scikit-learn developers, 2021)"</p>
<p>$Recall = \frac{TP}{TP + FN}$</p>
<p>Precision is the number of true positives divided by the total number of predicted positives. It is the "ability of the classifier not to label as positive a sample that is negative" (scikit-learn developers, 2021). In other words, it is the ability of the model to avoid Type I error (Bhandari, 2021).</p>
<p>$Precision = \frac{TP}{TP+FP}$</p>
<p>Finally, $F_{\beta}$ is the "weighted harmonic mean of the precision and recall," and $F_1$ is the version where both of these factors are given equal importance (scikit-learn developers, 2021).</p>
<p>$F1 = \frac{2 TP}{2 TP + FP + FN}$</p>
<p>Let us calculate these metrics for the spam filter using the confusion matrix.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tp</span> <span class="o">=</span> <span class="mi">136</span>
<span class="n">tn</span> <span class="o">=</span> <span class="mi">964</span>
<span class="n">fp</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">fn</span> <span class="o">=</span> <span class="mi">13</span>

<span class="n">metrics</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">metrics</span><span class="p">[</span><span class="s2">"recall"</span><span class="p">]</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>
<span class="n">metrics</span><span class="p">[</span><span class="s2">"precision"</span><span class="p">]</span> <span class="o">=</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span><span class="p">)</span>
<span class="n">metrics</span><span class="p">[</span><span class="s2">"f1"</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">tp</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">tp</span> <span class="o">+</span> <span class="n">fp</span> <span class="o">+</span> <span class="n">fn</span><span class="p">)</span>

<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">metrics</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">metrics</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">%"</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>recall: 91.28%
precision: 99.27%
f1: 95.10%
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>All three metrics are above 90%. In particular, precision is 99.27%, which means that the model is very good at avoiding labelling ham messages as spam.</p>
<p>Therefore, we can say that the naive bayes algorithm performs very well with the data that it was given.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="scikit-learn-Classes-for-Naive-Bayes">
<a class="anchor" href="#scikit-learn-Classes-for-Naive-Bayes" aria-hidden="true"><span class="octicon octicon-link"></span></a>scikit-learn Classes for Naive Bayes<a class="anchor-link" href="#scikit-learn-Classes-for-Naive-Bayes"> </a>
</h1>
<p>In practice, a data scientist would not code the entire algorithm each time they use it, since this is time-consuming. Instead, one can use prepackaged classes in scikit-learn.</p>
<p>For the purpose of classifying spam based on word counts, we can apply the following classes, according to the scikit-learn developers (2021):</p>
<ul>
<li>
<code>MultinomialNB</code>: This uses the same logic as the algorithm explained earlier.</li>
<li>
<code>GaussianNB</code>: "The likelihood of the features is assumed to be Gaussian," so the mean and standard deviation of each features is considered.</li>
<li>
<code>ComplementNB</code>: It is an "adaptation of the standard multinomial naive Bayes (MNB) algorithm that is particularly suited for imbalanced data sets." This may be useful for our dataset because the percentages of spam and non-spam messages are imbalanced.</li>
</ul>
<p>Other classes which will not be used in this project include <code>BernoulliNB</code>, which assumes each feature to be binary (only two categories), and <code>CategoricalNB</code>, which assumes that each feature is categorical rather than numeric.</p>
<p>Let us try using the first three classes and comparing them. We will also use functions from <code>sklearn.metrics</code> to calculate accuracy score and the other metrics.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.naive_bayes</span> <span class="kn">import</span> <span class="n">MultinomialNB</span><span class="p">,</span> <span class="n">GaussianNB</span><span class="p">,</span> <span class="n">ComplementNB</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">precision_score</span><span class="p">,</span> <span class="n">recall_score</span><span class="p">,</span> <span class="n">f1_score</span>

<span class="n">nb_classes</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Multinomial"</span><span class="p">:</span> <span class="n">MultinomialNB</span><span class="p">,</span>
    <span class="s2">"Gaussian"</span><span class="p">:</span> <span class="n">GaussianNB</span><span class="p">,</span>
    <span class="s2">"Complement"</span><span class="p">:</span> <span class="n">ComplementNB</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">metric_funcs</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"Accuracy"</span><span class="p">:</span> <span class="n">accuracy_score</span><span class="p">,</span>
    <span class="s2">"Precision"</span><span class="p">:</span> <span class="n">precision_score</span><span class="p">,</span>
    <span class="s2">"Recall"</span><span class="p">:</span> <span class="n">recall_score</span><span class="p">,</span>
    <span class="s2">"F1"</span><span class="p">:</span> <span class="n">f1_score</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">result_rows</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">test_word_counts</span> <span class="o">=</span> <span class="n">to_word_counts</span><span class="p">(</span><span class="n">X_test_preprocessed</span><span class="p">)</span>

<span class="k">for</span> <span class="n">class_name</span> <span class="ow">in</span> <span class="n">nb_classes</span><span class="p">:</span>
    <span class="n">nb</span> <span class="o">=</span> <span class="n">nb_classes</span><span class="p">[</span><span class="n">class_name</span><span class="p">]</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">nb</span><span class="p">()</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span>
        <span class="n">word_counts</span><span class="p">,</span>
        <span class="n">y_train</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_word_counts</span><span class="p">)</span>

    <span class="n">metric_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="s2">"float64"</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">metric_name</span><span class="p">,</span> <span class="n">score_func</span> <span class="ow">in</span> <span class="n">metric_funcs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">metric_name</span> <span class="o">==</span> <span class="s2">"Accuracy"</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">score_func</span><span class="p">(</span>
                <span class="n">y_true</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">,</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">score</span> <span class="o">=</span> <span class="n">score_func</span><span class="p">(</span>
                <span class="n">y_true</span> <span class="o">=</span> <span class="n">y_test</span><span class="p">,</span>
                <span class="n">y_pred</span> <span class="o">=</span> <span class="n">y_pred</span><span class="p">,</span>
                <span class="n">pos_label</span> <span class="o">=</span> <span class="s2">"spam"</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="n">metric_results</span><span class="p">[</span><span class="n">metric_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">score</span> <span class="o">*</span> <span class="mi">100</span>

    <span class="n">result_rows</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">metric_results</span><span class="p">)</span>

<span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">result_rows</span><span class="p">)</span>

<span class="n">result_df</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Accuracy</th>
      <th>Precision</th>
      <th>Recall</th>
      <th>F1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Multinomial</th>
      <td>98.743268</td>
      <td>99.270073</td>
      <td>91.275168</td>
      <td>95.104895</td>
    </tr>
    <tr>
      <th>Gaussian</th>
      <td>90.843806</td>
      <td>60.444444</td>
      <td>91.275168</td>
      <td>72.727273</td>
    </tr>
    <tr>
      <th>Complement</th>
      <td>97.396768</td>
      <td>88.461538</td>
      <td>92.617450</td>
      <td>90.491803</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>MultinomialNB</code> performed the best, as it had the highest accuracy, precision, and F1 score. Its accuracy was 98.74%, which is the same as the accuracy of the algorithm that I manually coded earlier. Thus, I know that what I coded was correct.</p>
<p><code>ComplementNB</code> also performed well, though its precision was 88%, meaning that it was more prone to labeling ham messages as spam. However, the <code>GaussianNB</code> class was the worst performing one, as its precision was 60% and its F1 was 73%. This likely occurred because the assumption that the features' likelihoods were Gaussian did not hold.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Conclusion">
<a class="anchor" href="#Conclusion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Conclusion<a class="anchor-link" href="#Conclusion"> </a>
</h1>
<p>In this project, we obtained a dataset of spam and non-spam messages, used this to calculate the parameters for a multinomial naive bayes algorithm, wrote a function to predict whether a new message is spam or non-spam, evaluated the model using various performance metrics, and tried three variations of the model in scikit-learn.</p>
<p>Naive bayes is just one of various classification models, such as SVM, logistic regression, random forest, etc. It is useful as most of its calculations are done during the training stage, so it is fast at making predictions. However, it is not perfect, as the assumption that the features are independent usually does not hold true in real life. (Gupta, 2020)</p>
<p>However, models cannot represent reality perfectly. Simplifications like this are good enough if they are useful in making predictions or testing relationships among variables.</p>
<p>Another important insight from this project is that accuracy should not be the only metric used to evaluate model performance. We should use other metrics like recall, precision, and F1 score, which provide more nuanced perspectives. Though this was not done for this project, in other scenarios, we may have to adjust the model to favor either recall or precision depending on the specific use case.</p>
<p>Thanks for reading!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Bibliography">
<a class="anchor" href="#Bibliography" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bibliography<a class="anchor-link" href="#Bibliography"> </a>
</h1>
<h2 id="Data-Source">
<a class="anchor" href="#Data-Source" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data Source<a class="anchor-link" href="#Data-Source"> </a>
</h2>
<p>Almeida, T. A., &amp; Hidalgo, J. M. G. (2012, June 22). SMS Spam Collection Data Set. UCI Machine Learning Repository. <a href="https://archive.ics.uci.edu/ml/datasets/sms+spam+collection#">https://archive.ics.uci.edu/ml/datasets/sms+spam+collection#</a></p>
<h2 id="Information-Sources">
<a class="anchor" href="#Information-Sources" aria-hidden="true"><span class="octicon octicon-link"></span></a>Information Sources<a class="anchor-link" href="#Information-Sources"> </a>
</h2>
<p>Bhandari, P. (2021, January 18). Type I and Type II errors. Scribbr. <a href="https://www.scribbr.com/statistics/type-i-and-type-ii-errors/">https://www.scribbr.com/statistics/type-i-and-type-ii-errors/</a></p>
<p>Brownlee, J. (2016, November 17). What is a Confusion Matrix in Machine Learning. Machine Learning Mastery. <a href="https://machinelearningmastery.com/confusion-matrix-machine-learning/">https://machinelearningmastery.com/confusion-matrix-machine-learning/</a></p>
<p>Brownlee, J. (2020, August 27). How to Calculate Precision, Recall, F1, and More for Deep Learning Models. Machine Learning Mastery. <a href="https://machinelearningmastery.com/how-to-calculate-precision-recall-f1-and-more-for-deep-learning-models/">https://machinelearningmastery.com/how-to-calculate-precision-recall-f1-and-more-for-deep-learning-models/</a></p>
<p>Dataquest. (n.d.). Guided Project: Building A Spam Filter With Naive Bayes. Dataquest. Retrieved December 14, 2021, from <a href="https://www.dataquest.io/c/74/m/433/guided-project%3A-building-a-spam-filter-with-naive-bayes">https://www.dataquest.io/c/74/m/433/guided-project%3A-building-a-spam-filter-with-naive-bayes</a></p>
<p>Devanesan, J. (2020, August 19). Phishing scams dominate the Philippines cybercrime landscape. Tech Wire Asia. <a href="https://techwireasia.com/2020/08/phishing-scams-dominate-the-philippines-cybercrime-landscape/">https://techwireasia.com/2020/08/phishing-scams-dominate-the-philippines-cybercrime-landscape/</a></p>
<p>FTC CI. (2020, February 19). How To Recognize and Report Spam Text Messages. Federal Trade Commission Consumer Information. <a href="https://www.consumer.ftc.gov/articles/how-recognize-and-report-spam-text-messages">https://www.consumer.ftc.gov/articles/how-recognize-and-report-spam-text-messages</a></p>
<p>Gupta, S. (2020, February 28). Pros and cons of various Classification ML algorithms. Medium. <a href="https://towardsdatascience.com/pros-and-cons-of-various-classification-ml-algorithms-3b5bfb3c87d6">https://towardsdatascience.com/pros-and-cons-of-various-classification-ml-algorithms-3b5bfb3c87d6</a></p>
<p>scikit-learn developers. (2021). 1.9. Naive Bayes. Scikit-Learn. <a href="https://scikit-learn/stable/modules/naive_bayes.html">https://scikit-learn/stable/modules/naive_bayes.html</a></p>
<p>scikit-learn developers. (2021). 3.3. Metrics and scoring: Quantifying the quality of predictions. Scikit-Learn. <a href="https://scikit-learn/stable/modules/model_evaluation.html">https://scikit-learn/stable/modules/model_evaluation.html</a></p>
<p>Thomas, L. (2020, September 18). How to use stratified sampling. Scribbr. <a href="https://www.scribbr.com/methodology/stratified-sampling/">https://www.scribbr.com/methodology/stratified-sampling/</a>
Vadapalli, P. (2021, January 5). Naive Bayes Explained: Function, Advantages &amp; Disadvantages, Applications in 2021. UpGrad Blog. <a href="https://www.upgrad.com/blog/naive-bayes-explained/">https://www.upgrad.com/blog/naive-bayes-explained/</a></p>
<p>Vallantin, L. (2018, September 6). Why you should not trust only in accuracy to measure machine learning performance. Medium. <a href="https://medium.com/@limavallantin/why-you-should-not-trust-only-in-accuracy-to-measure-machine-learning-performance-a72cf00b4516">https://medium.com/@limavallantin/why-you-should-not-trust-only-in-accuracy-to-measure-machine-learning-performance-a72cf00b4516</a></p>
<p>Yap, C. (2021, November 25). Millions of spam messages blocked in Philippines as scams surge. Yahoo News. <a href="https://ph.news.yahoo.com/millions-of-spam-messages-blocked-in-philippines-as-scams-surge-005658569.html">https://ph.news.yahoo.com/millions-of-spam-messages-blocked-in-philippines-as-scams-surge-005658569.html</a></p>
<h2 id="Image-Source">
<a class="anchor" href="#Image-Source" aria-hidden="true"><span class="octicon octicon-link"></span></a>Image Source<a class="anchor-link" href="#Image-Source"> </a>
</h2>
<p>Johnson, H. (2020, February 24). Photo by Hannes Johnson on Unsplash. Unsplash. <a href="https://unsplash.com/photos/mRgffV3Hc6c">https://unsplash.com/photos/mRgffV3Hc6c</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Appendix">
<a class="anchor" href="#Appendix" aria-hidden="true"><span class="octicon octicon-link"></span></a>Appendix<a class="anchor-link" href="#Appendix"> </a>
</h1>
<p>Here, I explain how the multinomial naive bayes algorithm was derived from the Bayes Theorem. This was originally placed earlier in the post, but I deemed it to be unnecessary for that part.
</p>
<div class="flash">
    <svg class="octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
    <strong>Note: </strong>The mathematical explanations below are not my own ideas. I learned these from the Dataquest course on Naive Bayes.
</div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Given two events $A$ and $B$, we can use the theorem to determine the probability that $B$ happened given that $A$ happened. This probability is written as $P(B|A)$.</p>
<p>$P(B|A) = \frac{P(B) \cdot P(A|B)}{\Sigma_{i = 1}^n (P(B_i) \cdot P(A|B_i))}$</p>
<p>In this case, $B_1$ is the event that the message is non-spam, and $B_2$ is the event that it is spam. $B$ can refer to either $B_1$ or $B_2$, depending on which probability we want to calculate. Also, $A$ refers to the specific contents of one message.</p>
<p>In order to make things clearer, let us say that $Spam$ is the event that the message is spam, and $Ham$ is the event that the message is non-spam.</p>
<p>Then, let us expand event $A$ (the message itself) in order to consider the individual words inside it. For example, the first word in a message can be labeled $w_1$. If we have a total of $n$ words, then the words can be labeled as $w_1, w_2, \dots , w_n$.</p>
<p>Thus, we can rewrite the equation. Here is the probability of a given message being spam:</p>
<p>$P(Spam|w_1, w_2, \dots , w_n) = \frac{P(Spam) \cdot P(w_1, w_2, \dots , w_n|Spam)}{\Sigma_{i = 1}^n (P(B_i) \cdot P(w_1, w_2, \dots , w_n|B_i))}$</p>
<p>Here is the probability of a given message being non-spam:</p>
<p>$P(Ham|w_1, w_2, \dots , w_n) = \frac{P(Ham) \cdot P(w_1, w_2, \dots , w_n|Ham)}{\Sigma_{i = 1}^n (P(B_i) \cdot P(w_1, w_2, \dots , w_n|B_i))}$</p>
<p>Notice that the denominators are the same. Since we only want to compare these two probabilities, we can skip calculating the denominator and just calculate the numerators. We can thus rewrite the equation as follows. Note that the $\propto$ symbol is used instead of $=$ because the two quantities are not equal but directly proportional.</p>
<p>$P(Spam|w_1, w_2, \dots , w_n) \propto P(Spam) \cdot P(w_1, w_2, \dots , w_n|Spam)$</p>
<p>The first factor, $P(Spam)$, is easy to find, as it is simply the number of spam messages divided by the total number of messages. However, $P(w_1, w_2, \dots , w_n|Spam)$ needs to be further expanded.</p>
<p>If we make the assumption that the probability of each word is independent of the probability of the other words, we can use the multiplication rule. The assumption of independence is what makes the algorithm "naive," as it usually doesn't hold true in reality. However, the algorithm is still useful for predictions despite this.</p>
<p>$P(Spam) \cdot P(w_1, w_2, \dots , w_n|Spam) \\ = P(Spam) \cdot P(w_1 \cap w_2 \cap \dots \cap w_n | Spam) \\ = P(Spam) \cdot P(w_1|Spam) \cdot P(w_2|Spam) \cdot \dots \cdot P(w_n|Spam)$</p>
<p>Note that we still have to find the probability of each word given $Spam$ because we assume that the presence of each word is dependent on $Spam$.</p>
<p>Thus, the final formula is:</p>
<p>$P(Spam|w_1, w_2, \dots , w_n) \propto P(Spam) \cdot \Pi_{i=1}^n P(w_i|Spam)$</p>
<p>Likewise, the formula for $Ham$ is:</p>
<p>$P(Ham|w_1, w_2, \dots , w_n) \propto P(Ham) \cdot \Pi_{i=1}^n P(w_i|Ham)$</p>

</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="MiguelAHG/mahg-data-science"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/mahg-data-science/python/pandas/numpy/matplotlib/scikit-learn/2021/12/14/Naive-Bayes-Algorithm-Detecting-Spam-Messages.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/mahg-data-science/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/mahg-data-science/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/mahg-data-science/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A blog and portfolio of data science projects by Migs Germar.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/MiguelAHG" title="MiguelAHG"><svg class="svg-icon grey"><use xlink:href="/mahg-data-science/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
